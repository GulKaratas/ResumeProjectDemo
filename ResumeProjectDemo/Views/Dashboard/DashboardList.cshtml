@using ResumeProjectDemo.Entities
@{
    ViewData["Title"] = "Dashboard";
    ViewData["ActivePage"] = "Dashboard";
    Layout = "~/Views/AdminLayout/Index.cshtml";
    var recentMessages = ViewBag.RecentMessages as List<Message>;
    var recentProjects = ViewBag.RecentProjects as List<Portfolio>;
    var topSkills = ViewBag.TopSkills as List<Skils>;
}

<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white min-h-screen">
    <main class="max-w-[1400px] mx-auto px-4 py-4">

        <!-- Welcome Section -->
        <div class="mb-4">
            <div class="flex items-center gap-2 mb-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-primary/70 flex items-center justify-center shadow-lg shadow-primary/30">
                    <span class="material-symbols-outlined text-white text-xl">dashboard</span>
                </div>
                <div>
                    <h1 class="text-slate-900 dark:text-white text-2xl font-black leading-tight tracking-[-0.033em]">
                        Dashboard
                    </h1>
                    <p class="text-slate-500 dark:text-[#92c0c9] text-xs font-normal">
                        Portfolio yönetim panelinize hoş geldiniz 👋
                    </p>
                </div>
            </div>
        </div>

        <!-- Stats Cards Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            
            <!-- Total Projects Card -->
            <div class="glass-card rounded-xl p-4 hover:shadow-xl transition-all duration-300 group border-l-4 border-blue-500">
                <div class="flex items-center justify-between mb-2">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-white text-xl">folder_open</span>
                    </div>
                </div>
                <div class="space-y-1">
                    <p class="text-2xl font-black text-slate-900 dark:text-white">@ViewBag.TotalProjects</p>
                    <p class="text-xs text-slate-600 dark:text-slate-400 font-semibold">Toplam Proje</p>
                    <a href="/Portfolio/PortfolioList" class="text-[10px] text-blue-600 dark:text-blue-400 font-bold hover:underline">Görüntüle →</a>
                </div>
            </div>

            <!-- Unread Messages Card -->
            <div class="glass-card rounded-xl p-4 hover:shadow-xl transition-all duration-300 group border-l-4 border-orange-500">
                <div class="flex items-center justify-between mb-2">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg shadow-orange-500/30 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-white text-xl">mail</span>
                    </div>
                </div>
                <div class="space-y-1">
                    <p class="text-2xl font-black text-slate-900 dark:text-white">@ViewBag.UnreadMessages</p>
                    <p class="text-xs text-slate-600 dark:text-slate-400 font-semibold">Okunmamış Mesaj</p>
                    @if (ViewBag.UnreadMessages > 0)
                    {
                        <span class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 font-bold text-[10px]">
                            <span class="w-1 h-1 rounded-full bg-red-500 animate-pulse"></span>
                            Yeni
                        </span>
                    }
                </div>
            </div>

            <!-- Total Skills Card -->
            <div class="glass-card rounded-xl p-4 hover:shadow-xl transition-all duration-300 group border-l-4 border-purple-500">
                <div class="flex items-center justify-between mb-2">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg shadow-purple-500/30 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-white text-xl">bolt</span>
                    </div>
                </div>
                <div class="space-y-1">
                    <p class="text-2xl font-black text-slate-900 dark:text-white">@ViewBag.TotalSkills</p>
                    <p class="text-xs text-slate-600 dark:text-slate-400 font-semibold">Toplam Yetenek</p>
                    <a href="/Skills/SkillsList" class="text-[10px] text-purple-600 dark:text-purple-400 font-bold hover:underline">Yönet →</a>
                </div>
            </div>

            <!-- Experiences & Education Card -->
            <div class="glass-card rounded-xl p-4 hover:shadow-xl transition-all duration-300 group border-l-4 border-green-500">
                <div class="flex items-center justify-between mb-2">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg shadow-green-500/30 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-white text-xl">school</span>
                    </div>
                </div>
                <div class="space-y-1">
                    <p class="text-2xl font-black text-slate-900 dark:text-white">@(ViewBag.TotalExperiences + ViewBag.TotalEducations)</p>
                    <p class="text-xs text-slate-600 dark:text-slate-400 font-semibold">Deneyim & Eğitim</p>
                    <div class="flex gap-2 text-[10px]">
                        <span class="text-slate-500">@ViewBag.TotalExperiences İş</span>
                        <span class="text-slate-500">•</span>
                        <span class="text-slate-500">@ViewBag.TotalEducations Eğitim</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6 items-stretch">
            
            <!-- Recent Messages - Takes 2 columns -->
            <div class="lg:col-span-2 h-full">
                <div class="glass-card rounded-xl overflow-hidden h-full">
                    <div class="p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-primary/5 to-transparent">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-primary text-lg">mail</span>
                                </div>
                                <div>
                                    <h2 class="text-base font-black text-slate-900 dark:text-white">Son Mesajlar</h2>
                                    <p class="text-[10px] text-slate-500 dark:text-slate-400">En son gelen mesajlar</p>
                                </div>
                            </div>
                            <a href="/Message/MessageList" class="flex items-center gap-1 text-xs font-bold text-primary hover:text-primary/80 transition-colors group">
                                Tümünü Gör
                                <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
                            </a>
                        </div>
                    </div>

                    <div class="divide-y divide-slate-200 dark:divide-slate-700">
                        @if (recentMessages != null && recentMessages.Any())
                        {
                            @foreach (var message in recentMessages)
                            {
                                var colors = new[] { "blue", "purple", "green", "pink", "orange" };
                                var color = colors[recentMessages.IndexOf(message) % colors.Length];
                                var initial = message.NameSurname?.FirstOrDefault().ToString().ToUpper() ?? "?";
                                var timeAgo = (DateTime.Now - message.SendDate).TotalHours < 24 
                                    ? $"{(int)(DateTime.Now - message.SendDate).TotalHours} saat önce" 
                                    : $"{(int)(DateTime.Now - message.SendDate).TotalDays} gün önce";
                                
                                <a href="/Message/MessageList" class="flex items-start gap-3 p-3 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all group @(!message.IsRead ? "" : "opacity-75")">
                                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-@(color)-500 to-@(color)-600 flex items-center justify-center text-white font-bold text-sm flex-shrink-0 shadow-lg group-hover:scale-110 transition-transform">
                                        @initial
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-start justify-between gap-2 mb-1">
                                            <div class="flex-1">
                                                <h4 class="font-bold text-slate-900 dark:text-white text-sm mb-0.5 group-hover:text-primary transition-colors">@message.NameSurname</h4>
                                                <p class="text-xs text-slate-600 dark:text-slate-400 font-medium">@message.Subject</p>
                                            </div>
                                            <span class="text-[10px] text-slate-500 dark:text-slate-400 flex-shrink-0">@timeAgo</span>
                                        </div>
                                        <p class="text-xs text-slate-500 dark:text-slate-500 line-clamp-2">@message.MessageDetail</p>
                                    </div>
                                    @if (!message.IsRead)
                                    {
                                        <div class="flex-shrink-0">
                                            <span class="w-2 h-2 rounded-full bg-orange-500 block shadow-lg shadow-orange-500/50"></span>
                                        </div>
                                    }
                                </a>
                            }
                        }
                        else
                        {
                            <div class="p-8 text-center">
                                <span class="material-symbols-outlined text-slate-300 dark:text-slate-700 text-5xl mb-2">mail</span>
                                <p class="text-sm text-slate-500 dark:text-slate-400">Henüz mesaj bulunmamaktadır</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="h-full flex flex-col gap-4">
                
                <!-- Quick Actions Card -->
                <div class="glass-card rounded-xl overflow-hidden flex-1 flex flex-col">
                    <div class="p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-primary/5 to-transparent">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary text-lg">bolt</span>
                            </div>
                            <div>
                                <h2 class="text-base font-black text-slate-900 dark:text-white">Hızlı İşlemler</h2>
                                <p class="text-[10px] text-slate-500 dark:text-slate-400">Sık kullanılan işlemler</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-3 space-y-2 flex-1 flex flex-col justify-center">
                        <a href="/Portfolio/CreatePortfolio" class="flex items-center gap-2 p-2.5 rounded-lg hover:bg-gradient-to-r hover:from-blue-50 hover:to-blue-50/50 dark:hover:from-blue-900/20 dark:hover:to-blue-900/10 transition-all group border border-transparent hover:border-blue-200 dark:hover:border-blue-800">
                            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30 group-hover:scale-110 transition-transform">
                                <span class="material-symbols-outlined text-white text-lg">add_circle</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-xs font-bold text-slate-900 dark:text-white">Yeni Proje Ekle</p>
                                <p class="text-[10px] text-slate-500 dark:text-slate-400">Portfolio'ya proje ekle</p>
                            </div>
                            <span class="material-symbols-outlined text-slate-400 group-hover:text-blue-600 transition-colors text-lg">arrow_forward</span>
                        </a>

                        <a href="/Skills/SkillsList" class="flex items-center gap-2 p-2.5 rounded-lg hover:bg-gradient-to-r hover:from-purple-50 hover:to-purple-50/50 dark:hover:from-purple-900/20 dark:hover:to-purple-900/10 transition-all group border border-transparent hover:border-purple-200 dark:hover:border-purple-800">
                            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg shadow-purple-500/30 group-hover:scale-110 transition-transform">
                                <span class="material-symbols-outlined text-white text-lg">psychology</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-xs font-bold text-slate-900 dark:text-white">Yetenek Ekle</p>
                                <p class="text-[10px] text-slate-500 dark:text-slate-400">Becerilerini güncelle</p>
                            </div>
                            <span class="material-symbols-outlined text-slate-400 group-hover:text-purple-600 transition-colors text-lg">arrow_forward</span>
                        </a>

                        <a href="/Message/MessageList" class="flex items-center gap-2 p-2.5 rounded-lg hover:bg-gradient-to-r hover:from-orange-50 hover:to-orange-50/50 dark:hover:from-orange-900/20 dark:hover:to-orange-900/10 transition-all group border border-transparent hover:border-orange-200 dark:hover:border-orange-800">
                            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg shadow-orange-500/30 group-hover:scale-110 transition-transform relative">
                                <span class="material-symbols-outlined text-white text-lg">mail</span>
                                @if (ViewBag.UnreadMessages > 0)
                                {
                                    <span class="absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center border-2 border-white dark:border-slate-800">@ViewBag.UnreadMessages</span>
                                }
                            </div>
                            <div class="flex-1">
                                <p class="text-xs font-bold text-slate-900 dark:text-white">Mesajları Gör</p>
                                <p class="text-[10px] text-slate-500 dark:text-slate-400">@ViewBag.UnreadMessages okunmamış mesaj</p>
                            </div>
                            <span class="material-symbols-outlined text-slate-400 group-hover:text-orange-600 transition-colors text-lg">arrow_forward</span>
                        </a>

                        <a href="/About/AboutList" class="flex items-center gap-2 p-2.5 rounded-lg hover:bg-gradient-to-r hover:from-green-50 hover:to-green-50/50 dark:hover:from-green-900/20 dark:hover:to-green-900/10 transition-all group border border-transparent hover:border-green-200 dark:hover:border-green-800">
                            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg shadow-green-500/30 group-hover:scale-110 transition-transform">
                                <span class="material-symbols-outlined text-white text-lg">edit</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-xs font-bold text-slate-900 dark:text-white">Profili Düzenle</p>
                                <p class="text-[10px] text-slate-500 dark:text-slate-400">Bilgileri güncelle</p>
                            </div>
                            <span class="material-symbols-outlined text-slate-400 group-hover:text-green-600 transition-colors text-lg">arrow_forward</span>
                        </a>
                    </div>
                </div>

            </div>

        </div>

        <!-- Chart Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 items-stretch">
            
            <!-- Projects Carousel -->
            <div class="glass-card rounded-xl overflow-hidden h-full flex flex-col">
                <div class="p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-primary/5 to-transparent">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary text-lg">folder_open</span>
                            </div>
                            <div>
                                <h2 class="text-base font-black text-slate-900 dark:text-white">Projelerim</h2>
                                <p class="text-[10px] text-slate-500 dark:text-slate-400">Son eklenen projeler</p>
                            </div>
                        </div>
                        <a href="/Portfolio/PortfolioList" class="text-xs font-bold text-primary hover:text-primary/80 transition-colors">
                            Tümü →
                        </a>
                    </div>
                </div>

                <div class="relative flex-1 flex items-center">
                    @if (recentProjects != null && recentProjects.Any())
                    {
                        <div class="overflow-hidden w-full h-full">
                            <div id="projectCarousel" class="flex transition-transform duration-500 ease-out w-full h-full">
                                @foreach (var project in recentProjects)
                                {
                                    var colors = new[] { ("blue", "500", "600"), ("purple", "500", "600"), ("green", "500", "600"), ("orange", "500", "600") };
                                    var colorIndex = recentProjects.IndexOf(project) % colors.Length;
                                    var (colorName, shade1, shade2) = colors[colorIndex];
                                    
                                    <div class="w-full h-full flex-shrink-0 p-4">
                                        <div class="relative group h-full flex items-center">
                                            <div class="h-full w-full rounded-xl overflow-hidden bg-gradient-to-br from-@(colorName)-@(shade1) to-@(colorName)-@(shade2) shadow-xl">
                                                <img src="@project.ImageUrl" 
                                                     alt="@project.Title" 
                                                     class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                                                     onerror="this.src='https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800'">
                                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
                                            </div>
                                            <div class="absolute bottom-4 left-4 right-4">
                                                <span class="inline-block px-2 py-0.5 rounded-full text-[10px] font-bold bg-@(colorName)-500 text-white mb-2">@(project.Category?.CategoryName ?? "Proje")</span>
                                                <h3 class="text-base font-black text-white mb-1">@project.Title</h3>
                                                <p class="text-xs text-white/80">Portfolio Projesi #@project.PortfolioId</p>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>

                        @if (recentProjects.Count > 1)
                        {
                            <!-- Navigation Arrows -->
                            <button onclick="prevSlide()" class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                                <span class="material-symbols-outlined text-slate-900 dark:text-white">chevron_left</span>
                            </button>
                            <button onclick="nextSlide()" class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                                <span class="material-symbols-outlined text-slate-900 dark:text-white">chevron_right</span>
                            </button>

                            <!-- Pagination Dots -->
                            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                                @for (int i = 0; i < recentProjects.Count; i++)
                                {
                                    <button onclick="goToSlide(@i)" class="dot w-2 h-2 rounded-full bg-white/50 hover:bg-white transition-all"></button>
                                }
                            </div>
                        }
                    }
                    else
                    {
                        <div class="w-full h-full flex items-center justify-center p-8">
                            <div class="text-center">
                                <span class="material-symbols-outlined text-slate-300 dark:text-slate-700 text-5xl mb-2">folder_open</span>
                                <p class="text-sm text-slate-500 dark:text-slate-400">Henüz proje eklenmemiş</p>
                                <a href="/Portfolio/CreatePortfolio" class="mt-2 inline-block text-xs text-primary hover:underline">İlk Projeyi Ekle</a>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <!-- Top Skills Chart -->
            <div class="glass-card rounded-xl overflow-hidden h-full flex flex-col">
                <div class="p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-primary/5 to-transparent">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center">
                            <span class="material-symbols-outlined text-primary text-lg">leaderboard</span>
                        </div>
                        <div>
                            <h2 class="text-base font-black text-slate-900 dark:text-white">En İyi Yetenekler</h2>
                            <p class="text-[10px] text-slate-500 dark:text-slate-400">Teknoloji yetenek dağılımı</p>
                        </div>
                    </div>
                </div>

                <div class="p-4 space-y-3 flex-1 flex flex-col justify-center">
                    @if (topSkills != null && topSkills.Any())
                    {
                        @foreach (var skill in topSkills)
                        {
                            var skillColors = new[] { ("primary", "blue"), ("purple", "purple"), ("blue", "blue"), ("yellow", "yellow"), ("cyan", "cyan") };
                            var colorIndex = topSkills.IndexOf(skill) % skillColors.Length;
                            var (color1, color2) = skillColors[colorIndex];
                            
                            <div>
                                <div class="flex items-center justify-between mb-1.5">
                                    <div class="flex items-center gap-1.5">
                                        <div class="w-1.5 h-1.5 rounded-full bg-gradient-to-r from-@(color1)-500 to-@(color2)-500"></div>
                                        <span class="text-xs font-bold text-slate-900 dark:text-white">@skill.Title</span>
                                    </div>
                                    <span class="text-sm font-black text-@(color1)-600">@skill.Percentage%</span>
                                </div>
                                <div class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-@(color1)-500 to-@(color2)-600 rounded-full transition-all duration-1000 shadow-lg" style="width: @(skill.Percentage)%"></div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-center py-8">
                            <span class="material-symbols-outlined text-slate-300 dark:text-slate-700 text-4xl mb-2">bolt</span>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Henüz yetenek eklenmemiş</p>
                        </div>
                    }
                </div>
            </div>

        </div>

    </main>
</body>

<script>
    // Carousel için değişkenler
    let currentSlide = 0;
    const totalSlides = @(recentProjects?.Count ?? 0);
    let autoplayInterval;

    function updateCarousel() {
        const carousel = document.getElementById('projectCarousel');
        if (carousel && totalSlides > 0) {
            carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            // Pagination dots güncelle
            const dots = document.querySelectorAll('.dot');
            dots.forEach((dot, index) => {
                if (index === currentSlide) {
                    dot.classList.add('!w-8', '!bg-white');
                } else {
                    dot.classList.remove('!w-8', '!bg-white');
                }
            });
        }
    }

    function nextSlide() {
        if (totalSlides > 0) {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
            resetAutoplay();
        }
    }

    function prevSlide() {
        if (totalSlides > 0) {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateCarousel();
            resetAutoplay();
        }
    }

    function goToSlide(index) {
        currentSlide = index;
        updateCarousel();
        resetAutoplay();
    }

    function startAutoplay() {
        if (totalSlides > 1) {
            autoplayInterval = setInterval(() => {
                nextSlide();
            }, 4000); // 4 saniyede bir geçiş
        }
    }

    function resetAutoplay() {
        clearInterval(autoplayInterval);
        startAutoplay();
    }

    // Sayfa yüklendiğinde carousel'i başlat
    document.addEventListener('DOMContentLoaded', function() {
        updateCarousel();
        startAutoplay();
    });
</script>

<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .dark .glass-card {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
